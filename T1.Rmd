---
title: "Trabalho 1 - Aprendizado de Máquina"
output: html_notebook
---

```{r}
library(data.tree)

computeEntropy <- function(data, attIndex=NULL, classIndex) {
    
    #classes no problema
    classes <- unique(data[,classIndex])
    
    #se attIndex nao for informado, calcula a entropia (Info(D)) para o conjunto de dados inteiro
    if (is.null(attIndex)) {
        #a priori entropy
        entropy<-0
        for (ii in 1:length(classes)){
            temp<- length(which(data[,classIndex] == classes[ii]))
            prob <- temp/dim(data)[1]
            entropy <- entropy + (-(prob*log2(prob)))
        }
    } else{
        #caso contrário, calcula a entropia restrita a um subconjunto de dados 
        # (após particao por valor 'v' do atributo 'A')
        values<- unique(data[,attIndex])
        entropy<-0
        for (jj in 1:length(values)) {
            temp1 <- length(which(data[,attIndex] ==values[jj])) 
            prob1 <- temp1/dim(data)[1]
            data.subset <- data[which(data[,attIndex] ==values[jj]),]
            soma<-0
            for (ii in 1:length(classes)){
                temp<- length(which(data.subset[,classIndex]==classes[ii]))
                if(temp > 0){
                    prob <- temp/dim(data.subset)[1]
                    soma <- soma+(-(prob*log2(prob)))
                }else{
                    soma <- soma+0
                }
            }
            entropy <- entropy + (prob1*soma)
        }
    }
  entropy
    }  
  
computeTree <- function(tree, data){
  entropyClass <- computeEntropy(data, NULL, indexClass)
  entropies <- numeric(ncol(data)-1)
  for(i in 1:(ncol(data)-1)){
    entropies[i] <- entropyClass - computeEntropy(data, attIndex = i, indexClass)
  }
  maxGain <- which.max(entropies)
  test <- unique(data[maxGain])
  entropies <- NULL
  entropies <- numeric(nrow(test))
  subData <- list()

  if(is.null(tree)){
    tree  <- Node$new(colnames(data[maxGain]))
  }
  
  for(i in 1:(nrow(test))){
    child <- tree$AddChild(test[[1]][i])
    subData[[i]] <- data[which(data[[maxGain]]==test[[1]][i]),]
    if(length(unique(subData[[i]][,indexClass])) > 1){
      subData[[i]] <- computeTree(child, subData[[i]])
    } else {
      child$AddChild(unique(subData[[i]][,indexClass]))
    }
  }
  tree
}


data <- read.csv("dadosBenchmark.csv",header = TRUE,stringsAsFactors = FALSE,sep=";")
indexClass <- 5

tree <- NULL
tree <- computeTree(tree, data)
tree
```